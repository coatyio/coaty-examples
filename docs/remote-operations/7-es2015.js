(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{powV:function(t,e,i){"use strict";i.r(e),i.d(e,"LightModule",(function(){return M}));var o=i("PCNd"),n=i("tyNb"),a=i("zP0r"),r=i("lJxs"),l=i("GtPT"),c=i("2Vo4");class g extends l.Controller{onInit(){super.onInit(),this._light=this.createLight(),this._lightContext=this.createLightContext(this.options.building,this.options.floor,this.options.room),this._lightStatus=this.createLightStatus(this.options.lightOn,this.options.lightColor,this.options.lightLuminosity),this._lightColorChangeSubject=new c.a(this.convertLightStatusToColor()),this._lightColorChange$=this._lightColorChangeSubject.asObservable()}onCommunicationManagerStarting(){super.onCommunicationManagerStarting(),this.observeCallEvents()}get light(){return this._light}get lightContext(){return this._lightContext}get lightColorChange$(){return this._lightColorChange$}observeCallEvents(){return this.communicationManager.observeCall(this.runtime.commonOptions.extra.lightControlOperation,this._lightContext).subscribe(t=>{const e=t.data.getParameterByName("on"),i=t.data.getParameterByName("color"),o=t.data.getParameterByName("luminosity"),n=t.data.getParameterByName("switchTime");this.validateSwitchOpParams(e,i,o,n)?setTimeout(()=>{this.light.isDefect?t.returnEvent(l.ReturnEvent.withError(1,"Light is defect",{lightId:this._light.objectId,triggerTime:Date.now()})):(this.updateLightStatus(e,i,o),this._lightColorChangeSubject.next(this.convertLightStatusToColor()),t.returnEvent(l.ReturnEvent.withResult(this._lightStatus.on,{lightId:this._light.objectId,triggerTime:Date.now()})))},Math.max(0,void 0===n?0:n)):t.returnEvent(l.ReturnEvent.withError(l.RemoteCallErrorCode.InvalidParameters,l.RemoteCallErrorMessage.InvalidParameters,{lightId:this._light.objectId,triggerTime:Date.now()}))})}createLight(){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.Light",objectId:this.runtime.newUuid(),name:"Light",isDefect:!1}}createLightStatus(t,e,i){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightStatus",objectId:this.runtime.newUuid(),name:"LightStatus",parentObjectId:this._light.objectId,on:t,luminosity:i,color:e}}createLightContext(t,e,i){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightContext",objectId:this.runtime.newUuid(),name:"LightContext",parentObjectId:this._light.objectId,lightId:this._light.objectId,building:t,floor:e,room:i}}validateSwitchOpParams(t,e,i,o){return!(void 0!==t&&"boolean"!=typeof t||!(void 0===i||"number"==typeof i&&i>=0&&i<=1)||void 0!==o&&"number"!=typeof o||!function(t){return Array.isArray(t)&&4===t.length&&t[0]>=0&&t[0]<=255&&t[1]>=0&&t[1]<=255&&t[2]>=0&&t[2]<=255&&t[3]>=0&&t[3]<=1}(e)||0===e[0]&&0===e[1]&&0===e[2])}updateLightStatus(t,e,i){const{on:o,color:n,luminosity:a}=this._lightStatus;void 0===t||t===o?void 0===e||e===n?void 0===i||i===a||(this._lightStatus=this.createLightStatus(o,n,i)):this._lightStatus=this.createLightStatus(o,e,void 0===i||i===a?a:i):this._lightStatus=this.createLightStatus(t,void 0===e||e===n?n:e,void 0===i||i===a?a:i)}convertLightStatusToColor(){const{on:t,color:e,luminosity:i}=this._lightStatus;return t&&0!==i?`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${(i*e[3]).toFixed(2)})`:"transparent"}}var s=i("fXoL"),h=i("/Uk7"),d=i("ofXK"),b=i("tXAj"),m=i("Wp6s"),u=i("f0Cb"),p=i("NFeN"),C=i("Qu3c"),f=i("1jcm"),x=i("3Pt+"),v=i("0hV+"),w=i("5RNC"),k=i("bTqV");let I=(()=>{class t{transform(t,e){if(null!=t)return new Date}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Kb({name:"dateNow",type:t,pure:!0}),t})();function y(t,e){if(1&t&&(s.Qb(0,"mat-icon",10),s.wc(1),s.Pb()),2&t){const t=e.ngIf;s.hc("matTooltip",t.isOnline?"Connected to "+t.brokerHost:"Not connected to "+t.brokerHost),s.zb(1),s.yc(" ",t.isOnline?"wifi":"wifi_off"," ")}}function L(t,e){if(1&t&&s.Mb(0,"img",11),2&t){const t=e.ngIf,i=s.bc();s.rc("background-color",i.light.isDefect?"transparent":t)}}function P(t,e){1&t&&(s.Qb(0,"mat-card-content"),s.wc(1,"Initializing..."),s.Pb())}function Q(t,e){if(1&t){const t=s.Rb();s.Qb(0,"mat-card-content",12),s.Qb(1,"div",13),s.Qb(2,"mat-slide-toggle",14),s.Xb("ngModelChange",(function(e){return s.mc(t),s.bc().light.isDefect=e})),s.wc(3," Defect "),s.Pb(),s.Pb(),s.Qb(4,"qrcode",15,16),s.Xb("dragstart",(function(e){s.mc(t);const i=s.kc(5);return s.bc().onQrCodeDrag(e,i)}))("click",(function(e){return s.mc(t),s.bc().onQrCodeClick(e)})),s.Pb(),s.Qb(6,"h4",17),s.wc(7,"CONTEXT"),s.Pb(),s.Qb(8,"div",18),s.Qb(9,"div",19),s.wc(10,"Building"),s.Pb(),s.Qb(11,"mat-slider",20),s.Xb("ngModelChange",(function(e){return s.mc(t),s.bc().lightContext.building=e})),s.Pb(),s.Pb(),s.Qb(12,"div",18),s.Qb(13,"div",19),s.wc(14,"Floor"),s.Pb(),s.Qb(15,"mat-slider",20),s.Xb("ngModelChange",(function(e){return s.mc(t),s.bc().lightContext.floor=e})),s.Pb(),s.Pb(),s.Qb(16,"div",18),s.Qb(17,"div",19),s.wc(18,"Room"),s.Pb(),s.Qb(19,"mat-slider",20),s.Xb("ngModelChange",(function(e){return s.mc(t),s.bc().lightContext.room=e})),s.Pb(),s.Pb(),s.Pb()}if(2&t){const t=s.bc();s.zb(2),s.hc("color","warn")("ngModel",t.light.isDefect),s.zb(2),s.hc("title","")("qrdata",t.qrCodeUrl)("elementType","svg")("errorCorrectionLevel","M")("width","100%")("margin",0)("cssClass","light-map-card-image-qrcode-div"),s.zb(7),s.hc("min",t.lightContextRanges.building.min)("max",t.lightContextRanges.building.max)("tickInterval",t.lightContextRanges.building.tickInterval)("step",1)("thumbLabel",!0)("ngModel",t.lightContext.building),s.zb(4),s.hc("min",t.lightContextRanges.floor.min)("max",t.lightContextRanges.floor.max)("tickInterval",t.lightContextRanges.floor.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",t.lightContext.floor),s.zb(4),s.hc("min",t.lightContextRanges.room.min)("max",t.lightContextRanges.room.max)("tickInterval",t.lightContextRanges.room.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",t.lightContext.room)}}function S(t,e){if(1&t&&(s.Qb(0,"mat-card-footer",3),s.Qb(1,"div"),s.wc(2),s.cc(3,"date"),s.cc(4,"dateNow"),s.cc(5,"async"),s.Pb(),s.Qb(6,"div",21),s.Qb(7,"a",22),s.Mb(8,"img",23),s.Pb(),s.Qb(9,"a",24),s.Mb(10,"img",25),s.Pb(),s.Pb(),s.Pb()),2&t){const t=e.ngIf,i=s.bc();s.zb(2),s.yc("Last switched: ",s.ec(3,2,s.dc(4,5,s.dc(5,7,i.lastSwitched$)),"HH:mm:ss.SSS"),""),s.zb(5),s.hc("matTooltip",(null==t?null:t.packageInfo.name)+"@"+(null==t?null:t.packageInfo.version)+" on GitHub")}}const j=[{path:"",component:(()=>{class t{constructor(t,e,i){this.appContext=t,this.location=e,this.appContext.setContext("Light"),this.initNgModelBindings(),this.connectLightController(i)}ngOnDestroy(){this.lightContainer&&this.lightContainer.shutdown()}onQrCodeClick(t){window.open(this.qrCodeUrl,"_blank")}onQrCodeDrag(t,e){e.hide(),t.dataTransfer.setData("text/plain",this.qrCodeUrl),t.dataTransfer.setData("text/qrcode",this.qrCodeUrl)}getQrCodeUrl(){const t=this.location.prepareExternalUrl("/control?light_id="+(this.light?this.light.objectId:""));return window.location.protocol+"//"+window.location.host+t}initNgModelBindings(){this.lightContext={building:0,floor:0,room:0},this.lightContextRanges={building:{min:0,max:0,tickInterval:1},floor:{min:0,max:0,tickInterval:1},room:{min:0,max:0,tickInterval:1}}}connectLightController(t){t.resolveContainer("LightAgent","LightController",g).then(t=>{this.lightContainer=t;const e=t.getController("LightController");this.lightContextRanges=t.runtime.commonOptions.extra.lightContextRanges,this.light=e.light,this.lightContext=e.lightContext,this.lightColor$=e.lightColorChange$,this.lastSwitched$=e.lightColorChange$.pipe(Object(a.a)(1)),this.qrCodeUrl=this.getQrCodeUrl(),this.initBrokerConnectionInfo(e.options),this.appContext.setContext("Light #"+this.light.objectId)}).catch(t=>{throw new Error("Agent container for LightComponent couldn't be resolved: "+t)})}initBrokerConnectionInfo(t){this.brokerConnectionInfo$=this.lightContainer.communicationManager.observeCommunicationState().pipe(Object(r.a)(t=>({state:t,isOnline:t===l.CommunicationState.Online,brokerHost:this.lightContainer.communicationManager.options.brokerUrl})))}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(h.a),s.Lb(d.i),s.Lb(b.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-light"]],decls:17,vars:15,consts:[[1,"app-card","light-card-dark"],["mat-card-avatar","",1,"light-card-header-avatar"],[1,"app-text-with-ellipsis"],[1,"light-card-subtitle-dark"],["class","light-card-title-icon",3,"matTooltip",4,"ngIf"],["mat-card-image","","class","app-map-card-image-centered light-card-image-mask","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",3,"background-color",4,"ngIf","ngIfElse"],["initializing",""],["class","light-card-content",4,"ngIf"],[1,"light-card-divider-dark"],["class","light-card-subtitle-dark",4,"ngIf"],[1,"light-card-title-icon",3,"matTooltip"],["mat-card-image","","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",1,"app-map-card-image-centered","light-card-image-mask"],[1,"light-card-content"],[1,"light-operation-param"],["aria-label","light defect switch",3,"color","ngModel","ngModelChange"],["draggable","true","matTooltip","Click or scan or drag QR Code onto context filter to switch this light","matTooltipPosition","above",1,"light-map-card-image-qrcode",3,"title","qrdata","elementType","errorCorrectionLevel","width","margin","cssClass","dragstart","click"],["qrCodeTooltip","matTooltip"],[1,"app-heading-no-top-margin"],[1,"light-card-context"],[1,"light-card-slider-label"],[3,"min","max","tickInterval","step","thumbLabel","ngModel","ngModelChange"],[1,"app-card-footer-link-group"],["mat-button","","href","https://github.com/coatyio/coaty-examples/tree/master/remote-operations/js","target","_blank",3,"matTooltip"],["src","./assets/images/github-icon.svg","alt","github-logo"],["mat-button","","href","https://coaty.io","target","_blank"],["src","./assets/images/coaty-logo-accent.svg","alt","coaty-logo"]],template:function(t,e){if(1&t&&(s.Qb(0,"mat-card",0),s.Qb(1,"mat-card-header"),s.Mb(2,"a",1),s.Qb(3,"mat-card-title",2),s.wc(4),s.cc(5,"async"),s.Pb(),s.Qb(6,"mat-card-subtitle",3),s.wc(7),s.Pb(),s.uc(8,y,2,2,"mat-icon",4),s.cc(9,"async"),s.Pb(),s.uc(10,L,1,2,"img",5),s.cc(11,"async"),s.uc(12,P,2,0,"ng-template",null,6,s.vc),s.uc(14,Q,20,29,"mat-card-content",7),s.Mb(15,"mat-divider",8),s.uc(16,S,11,9,"mat-card-footer",9),s.Pb()),2&t){const t=s.kc(13);s.zb(4),s.yc("",s.dc(5,9,e.appContext.context$)," "),s.zb(3),s.Ac("Building ",null==e.lightContext?null:e.lightContext.building," \u22c5 Floor ",null==e.lightContext?null:e.lightContext.floor," \u22c5 Room ",null==e.lightContext?null:e.lightContext.room," "),s.zb(1),s.hc("ngIf",s.dc(9,11,e.brokerConnectionInfo$)),s.zb(2),s.hc("ngIf",s.dc(11,13,e.lightColor$))("ngIfElse",t),s.zb(4),s.hc("ngIf",e.lightContainer),s.zb(2),s.hc("ngIf",null==e.lightContainer?null:e.lightContainer.runtime.commonOptions.agentInfo)}},directives:[m.a,m.f,m.c,m.j,m.i,d.m,u.a,p.a,C.a,m.g,m.d,f.a,x.g,x.i,v.a,w.a,m.e,k.a],pipes:[d.b,d.e,I],styles:[".light-card-dark{background:#37474f;color:#eceff1}.light-card-divider-dark{background:#607d8b}.light-card-subtitle-dark{color:#b0bec5}.light-card-header-avatar{background-image:url(light-bulb-avatar.jpg);background-size:cover}.light-card-title-icon{margin-left:auto;margin-right:32px}.light-operation-param{color:#424242;display:flex;align-items:center;flex:0 0 auto;position:absolute!important;margin-top:calc(-65% + 8px)!important;left:12px;right:8px}.light-card-image-mask{background-image:url(light-bulb.jpg);background-size:cover;background-color:transparent;background-blend-mode:overlay;transition:background-color 1s linear}.light-map-card-image-qrcode{position:absolute!important;margin-top:calc(-30vw - 34px)!important;width:30vw;height:30vw;left:8px;right:8px;border:4px solid transparent;border-radius:4px;cursor:-webkit-grab;cursor:grab}.light-map-card-image-qrcode:hover{border-color:#ffd740}.light-map-card-image-qrcode-div{width:100%;height:100%}.light-card-content{margin-bottom:8px}.light-card-context{display:flex;align-items:center}.light-card-slider-label{align-self:baseline;min-width:4em}"],encapsulation:2,changeDetection:0}),t})()}];let T=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[n.c.forChild(j)],n.c]}),t})(),M=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[o.a,T]]}),t})()}}]);