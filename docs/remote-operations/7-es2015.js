(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{powV:function(t,e,i){"use strict";i.r(e),i.d(e,"LightModule",(function(){return j}));var o=i("PCNd"),n=i("tyNb"),a=i("zP0r"),r=i("lJxs"),l=i("GtPT"),c=i("2Vo4");class g extends l.Controller{onInit(){super.onInit(),this._light=this.createLight(),this._lightContext=this.createLightContext(this.options.building,this.options.floor,this.options.room),this._lightStatus=this.createLightStatus(this.options.lightOn,this.options.lightColor,this.options.lightLuminosity),this._lightColorChangeSubject=new c.a(this.convertLightStatusToColor()),this._lightColorChange$=this._lightColorChangeSubject.asObservable()}onCommunicationManagerStarting(){super.onCommunicationManagerStarting(),this.observeCallEvents()}get light(){return this._light}get lightContext(){return this._lightContext}get lightColorChange$(){return this._lightColorChange$}observeCallEvents(){return this.communicationManager.observeCall(this.runtime.commonOptions.extra.lightControlOperation,this._lightContext).subscribe(t=>{const e=t.data.getParameterByName("on"),i=t.data.getParameterByName("color"),o=t.data.getParameterByName("luminosity"),n=t.data.getParameterByName("switchTime");this.validateSwitchOpParams(e,i,o,n)?setTimeout(()=>{this.light.isDefect?t.returnEvent(l.ReturnEvent.withError(1,"Light is defect",{lightId:this._light.objectId,triggerTime:Date.now()})):(this.updateLightStatus(e,i,o),this._lightColorChangeSubject.next(this.convertLightStatusToColor()),t.returnEvent(l.ReturnEvent.withResult(this._lightStatus.on,{lightId:this._light.objectId,triggerTime:Date.now()})))},Math.max(0,void 0===n?0:n)):t.returnEvent(l.ReturnEvent.withError(l.RemoteCallErrorCode.InvalidParameters,l.RemoteCallErrorMessage.InvalidParameters,{lightId:this._light.objectId,triggerTime:Date.now()}))})}createLight(){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.Light",objectId:this.runtime.newUuid(),name:"Light",isDefect:!1}}createLightStatus(t,e,i){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightStatus",objectId:this.runtime.newUuid(),name:"LightStatus",parentObjectId:this._light.objectId,on:t,luminosity:i,color:e}}createLightContext(t,e,i){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightContext",objectId:this.runtime.newUuid(),name:"LightContext",parentObjectId:this._light.objectId,lightId:this._light.objectId,building:t,floor:e,room:i}}validateSwitchOpParams(t,e,i,o){return!(void 0!==t&&"boolean"!=typeof t||!(void 0===i||"number"==typeof i&&i>=0&&i<=1)||void 0!==o&&"number"!=typeof o||!function(t){return Array.isArray(t)&&4===t.length&&t[0]>=0&&t[0]<=255&&t[1]>=0&&t[1]<=255&&t[2]>=0&&t[2]<=255&&t[3]>=0&&t[3]<=1}(e)||0===e[0]&&0===e[1]&&0===e[2])}updateLightStatus(t,e,i){const{on:o,color:n,luminosity:a}=this._lightStatus;void 0===t||t===o?void 0===e||e===n?void 0===i||i===a||(this._lightStatus=this.createLightStatus(o,n,i)):this._lightStatus=this.createLightStatus(o,e,void 0===i||i===a?a:i):this._lightStatus=this.createLightStatus(t,void 0===e||e===n?n:e,void 0===i||i===a?a:i)}convertLightStatusToColor(){const{on:t,color:e,luminosity:i}=this._lightStatus;return t&&0!==i?`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${(i*e[3]).toFixed(2)})`:"transparent"}}var s=i("fXoL"),h=i("/Uk7"),d=i("ofXK"),b=i("tXAj"),m=i("Wp6s"),u=i("f0Cb"),p=i("NFeN"),C=i("Qu3c"),f=i("1jcm"),x=i("3Pt+"),v=i("DoL9"),k=i("5RNC"),y=i("bTqV");let S=(()=>{class t{transform(t,e){if(null!=t)return new Date}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Mb({name:"dateNow",type:t,pure:!0}),t})();function w(t,e){if(1&t&&(s.Sb(0,"mat-icon",10),s.yc(1),s.Rb()),2&t){const t=e.ngIf;s.kc("matTooltip",t.isOnline?"Connected to "+t.brokerHost:"Not connected to "+t.brokerHost),s.Bb(1),s.Ac(" ",t.isOnline?"wifi":"wifi_off"," ")}}function I(t,e){if(1&t&&s.Ob(0,"img",11),2&t){const t=e.ngIf,i=s.ec();s.vc("background-color",i.light.isDefect?"transparent":t)}}function R(t,e){1&t&&(s.Sb(0,"mat-card-content"),s.yc(1,"Initializing..."),s.Rb())}function L(t,e){if(1&t){const t=s.Tb();s.Sb(0,"mat-card-content",12),s.Sb(1,"div",13),s.Sb(2,"mat-slide-toggle",14),s.ac("ngModelChange",(function(e){return s.qc(t),s.ec().light.isDefect=e})),s.yc(3," Defect "),s.Rb(),s.Rb(),s.Sb(4,"qrcode",15,16),s.ac("dragstart",(function(e){s.qc(t);const i=s.oc(5);return s.ec().onQrCodeDrag(e,i)}))("click",(function(e){return s.qc(t),s.ec().onQrCodeClick(e)})),s.Rb(),s.Sb(6,"h4",17),s.yc(7,"CONTEXT"),s.Rb(),s.Sb(8,"div",18),s.Sb(9,"div",19),s.yc(10,"Building"),s.Rb(),s.Sb(11,"mat-slider",20),s.ac("ngModelChange",(function(e){return s.qc(t),s.ec().lightContext.building=e})),s.Rb(),s.Rb(),s.Sb(12,"div",18),s.Sb(13,"div",19),s.yc(14,"Floor"),s.Rb(),s.Sb(15,"mat-slider",20),s.ac("ngModelChange",(function(e){return s.qc(t),s.ec().lightContext.floor=e})),s.Rb(),s.Rb(),s.Sb(16,"div",18),s.Sb(17,"div",19),s.yc(18,"Room"),s.Rb(),s.Sb(19,"mat-slider",20),s.ac("ngModelChange",(function(e){return s.qc(t),s.ec().lightContext.room=e})),s.Rb(),s.Rb(),s.Rb()}if(2&t){const t=s.ec();s.Bb(2),s.kc("color","warn")("ngModel",t.light.isDefect),s.Bb(2),s.kc("title","")("qrdata",t.qrCodeUrl)("usesvg",!0)("level","M"),s.Bb(7),s.kc("min",t.lightContextRanges.building.min)("max",t.lightContextRanges.building.max)("tickInterval",t.lightContextRanges.building.tickInterval)("step",1)("thumbLabel",!0)("ngModel",t.lightContext.building),s.Bb(4),s.kc("min",t.lightContextRanges.floor.min)("max",t.lightContextRanges.floor.max)("tickInterval",t.lightContextRanges.floor.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",t.lightContext.floor),s.Bb(4),s.kc("min",t.lightContextRanges.room.min)("max",t.lightContextRanges.room.max)("tickInterval",t.lightContextRanges.room.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",t.lightContext.room)}}function _(t,e){if(1&t&&(s.Sb(0,"mat-card-footer",3),s.Sb(1,"div"),s.yc(2),s.fc(3,"date"),s.fc(4,"dateNow"),s.fc(5,"async"),s.Rb(),s.Sb(6,"div",21),s.Sb(7,"a",22),s.Ob(8,"img",23),s.Rb(),s.Sb(9,"a",24),s.Ob(10,"img",25),s.Rb(),s.Rb(),s.Rb()),2&t){const t=e.ngIf,i=s.ec();s.Bb(2),s.Ac("Last switched: ",s.hc(3,2,s.gc(4,5,s.gc(5,7,i.lastSwitched$)),"HH:mm:ss.SSS"),""),s.Bb(5),s.kc("matTooltip",(null==t?null:t.packageInfo.name)+"@"+(null==t?null:t.packageInfo.version)+" on GitHub")}}const O=[{path:"",component:(()=>{class t{constructor(t,e,i){this.appContext=t,this.location=e,this.appContext.setContext("Light"),this.initNgModelBindings(),this.connectLightController(i)}ngOnDestroy(){this.lightContainer&&this.lightContainer.shutdown()}onQrCodeClick(t){window.open(this.qrCodeUrl,"_blank")}onQrCodeDrag(t,e){e.hide(),t.dataTransfer.setData("text/plain",this.qrCodeUrl),t.dataTransfer.setData("text/qrcode",this.qrCodeUrl)}getQrCodeUrl(){const t=this.location.prepareExternalUrl(`/control?light_id=${this.light?this.light.objectId:""}`);return window.location.protocol+"//"+window.location.host+t}initNgModelBindings(){this.lightContext={building:0,floor:0,room:0},this.lightContextRanges={building:{min:0,max:0,tickInterval:1},floor:{min:0,max:0,tickInterval:1},room:{min:0,max:0,tickInterval:1}}}connectLightController(t){t.resolveContainer("LightAgent","LightController",g).then(t=>{this.lightContainer=t;const e=t.getController("LightController");this.lightContextRanges=t.runtime.commonOptions.extra.lightContextRanges,this.light=e.light,this.lightContext=e.lightContext,this.lightColor$=e.lightColorChange$,this.lastSwitched$=e.lightColorChange$.pipe(Object(a.a)(1)),this.qrCodeUrl=this.getQrCodeUrl(),this.initBrokerConnectionInfo(e.options),this.appContext.setContext(`Light #${this.light.objectId}`)}).catch(t=>{throw new Error(`Agent container for LightComponent couldn't be resolved: ${t}`)})}initBrokerConnectionInfo(t){this.brokerConnectionInfo$=this.lightContainer.communicationManager.observeCommunicationState().pipe(Object(r.a)(t=>({state:t,isOnline:t===l.CommunicationState.Online,brokerHost:this.lightContainer.communicationManager.options.brokerUrl})))}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(h.a),s.Nb(d.i),s.Nb(b.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["app-light"]],decls:17,vars:15,consts:[[1,"app-card","light-card-dark"],["mat-card-avatar","",1,"light-card-header-avatar"],[1,"app-text-with-ellipsis"],[1,"light-card-subtitle-dark"],["class","light-card-title-icon",3,"matTooltip",4,"ngIf"],["mat-card-image","","class","app-map-card-image-centered light-card-image-mask","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",3,"background-color",4,"ngIf","ngIfElse"],["initializing",""],["class","light-card-content",4,"ngIf"],[1,"light-card-divider-dark"],["class","light-card-subtitle-dark",4,"ngIf"],[1,"light-card-title-icon",3,"matTooltip"],["mat-card-image","","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",1,"app-map-card-image-centered","light-card-image-mask"],[1,"light-card-content"],[1,"light-operation-param"],["aria-label","light defect switch",3,"color","ngModel","ngModelChange"],["draggable","true","matTooltip","Click or scan or drag QR Code onto context filter to switch this light","matTooltipPosition","above",1,"light-map-card-image-qrcode",3,"title","qrdata","usesvg","level","dragstart","click"],["qrCodeTooltip","matTooltip"],[1,"app-heading-no-top-margin"],[1,"light-card-context"],[1,"light-card-slider-label"],[3,"min","max","tickInterval","step","thumbLabel","ngModel","ngModelChange"],[1,"app-card-footer-link-group"],["mat-button","","href","https://github.com/coatyio/coaty-examples/tree/master/remote-operations/js","target","_blank",3,"matTooltip"],["src","./assets/images/github-icon.svg","alt","github-logo"],["mat-button","","href","https://coaty.io","target","_blank"],["src","./assets/images/coaty-logo-accent.svg","alt","coaty-logo"]],template:function(t,e){if(1&t&&(s.Sb(0,"mat-card",0),s.Sb(1,"mat-card-header"),s.Ob(2,"a",1),s.Sb(3,"mat-card-title",2),s.yc(4),s.fc(5,"async"),s.Rb(),s.Sb(6,"mat-card-subtitle",3),s.yc(7),s.Rb(),s.wc(8,w,2,2,"mat-icon",4),s.fc(9,"async"),s.Rb(),s.wc(10,I,1,2,"img",5),s.fc(11,"async"),s.wc(12,R,2,0,"ng-template",null,6,s.xc),s.wc(14,L,20,26,"mat-card-content",7),s.Ob(15,"mat-divider",8),s.wc(16,_,11,9,"mat-card-footer",9),s.Rb()),2&t){const t=s.oc(13);s.Bb(4),s.Ac("",s.gc(5,9,e.appContext.context$)," "),s.Bb(3),s.Cc("Building ",null==e.lightContext?null:e.lightContext.building," \u22c5 Floor ",null==e.lightContext?null:e.lightContext.floor," \u22c5 Room ",null==e.lightContext?null:e.lightContext.room," "),s.Bb(1),s.kc("ngIf",s.gc(9,11,e.brokerConnectionInfo$)),s.Bb(2),s.kc("ngIf",s.gc(11,13,e.lightColor$))("ngIfElse",t),s.Bb(4),s.kc("ngIf",e.lightContainer),s.Bb(2),s.kc("ngIf",null==e.lightContainer?null:e.lightContainer.runtime.commonOptions.agentInfo)}},directives:[m.a,m.f,m.c,m.j,m.i,d.m,u.a,p.a,C.a,m.g,m.d,f.a,x.g,x.i,v.a,k.a,m.e,y.a],pipes:[d.b,d.e,S],styles:[".light-card-dark[_ngcontent-%COMP%]{background:#37474f;color:#eceff1}.light-card-divider-dark[_ngcontent-%COMP%]{background:#607d8b}.light-card-subtitle-dark[_ngcontent-%COMP%]{color:#b0bec5}.light-card-header-avatar[_ngcontent-%COMP%]{background-image:url(/coaty-examples/remote-operations/assets/images/light-bulb-avatar.jpg);background-size:cover}.light-card-title-icon[_ngcontent-%COMP%]{margin-left:auto;margin-right:32px}.light-operation-param[_ngcontent-%COMP%]{color:#424242;display:flex;align-items:center;flex:0 0 auto;position:absolute!important;margin-top:calc(-65% + 8px)!important;left:12px;right:8px}.light-card-image-mask[_ngcontent-%COMP%]{background-image:url(/coaty-examples/remote-operations/assets/images/light-bulb.jpg);background-size:cover;background-color:transparent;background-blend-mode:overlay;transition:background-color 1s linear}.light-map-card-image-qrcode[_ngcontent-%COMP%]{position:absolute!important;margin-top:calc(-30vw - 34px)!important;width:30vw;height:30vw;left:8px;right:8px;border:4px solid transparent;border-radius:4px;cursor:-webkit-grab;cursor:grab}.light-map-card-image-qrcode[_ngcontent-%COMP%]:hover{border-color:#ffd740}.light-card-content[_ngcontent-%COMP%]{margin-bottom:8px}.light-card-context[_ngcontent-%COMP%]{display:flex;align-items:center}.light-card-slider-label[_ngcontent-%COMP%]{align-self:baseline;min-width:4em}"],changeDetection:0}),t})()}];let M=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[n.c.forChild(O)],n.c]}),t})(),j=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[o.a,M]]}),t})()}}]);