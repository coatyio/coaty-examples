!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}function o(t,e,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return a(this,n)}}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{powV:function(e,a,l){"use strict";l.r(a),l.d(a,"LightModule",(function(){return $}));var g,s=l("PCNd"),h=l("tyNb"),u=l("zP0r"),d=l("lJxs"),b=l("GtPT"),m=l("2Vo4"),f=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(l,e);var a=r(l);function l(){return t(this,l),a.apply(this,arguments)}return n(l,[{key:"onInit",value:function(){o(c(l.prototype),"onInit",this).call(this),this._light=this.createLight(),this._lightContext=this.createLightContext(this.options.building,this.options.floor,this.options.room),this._lightStatus=this.createLightStatus(this.options.lightOn,this.options.lightColor,this.options.lightLuminosity),this._lightColorChangeSubject=new m.a(this.convertLightStatusToColor()),this._lightColorChange$=this._lightColorChangeSubject.asObservable()}},{key:"onCommunicationManagerStarting",value:function(){o(c(l.prototype),"onCommunicationManagerStarting",this).call(this),this.observeCallEvents()}},{key:"observeCallEvents",value:function(){var t=this;return this.communicationManager.observeCall(this.runtime.commonOptions.extra.lightControlOperation,this._lightContext).subscribe((function(e){var n=e.data.getParameterByName("on"),o=e.data.getParameterByName("color"),i=e.data.getParameterByName("luminosity"),r=e.data.getParameterByName("switchTime");t.validateSwitchOpParams(n,o,i,r)?setTimeout((function(){t.light.isDefect?e.returnEvent(b.ReturnEvent.withError(1,"Light is defect",{lightId:t._light.objectId,triggerTime:Date.now()})):(t.updateLightStatus(n,o,i),t._lightColorChangeSubject.next(t.convertLightStatusToColor()),e.returnEvent(b.ReturnEvent.withResult(t._lightStatus.on,{lightId:t._light.objectId,triggerTime:Date.now()})))}),Math.max(0,void 0===r?0:r)):e.returnEvent(b.ReturnEvent.withError(b.RemoteCallErrorCode.InvalidParameters,b.RemoteCallErrorMessage.InvalidParameters,{lightId:t._light.objectId,triggerTime:Date.now()}))}))}},{key:"createLight",value:function(){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.Light",objectId:this.runtime.newUuid(),name:"Light",isDefect:!1}}},{key:"createLightStatus",value:function(t,e,n){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightStatus",objectId:this.runtime.newUuid(),name:"LightStatus",parentObjectId:this._light.objectId,on:t,luminosity:n,color:e}}},{key:"createLightContext",value:function(t,e,n){return{coreType:"CoatyObject",objectType:"coaty.examples.remoteops.LightContext",objectId:this.runtime.newUuid(),name:"LightContext",parentObjectId:this._light.objectId,lightId:this._light.objectId,building:t,floor:e,room:n}}},{key:"validateSwitchOpParams",value:function(t,e,n,o){return!(void 0!==t&&"boolean"!=typeof t||!(void 0===n||"number"==typeof n&&n>=0&&n<=1)||void 0!==o&&"number"!=typeof o||!function(t){return Array.isArray(t)&&4===t.length&&t[0]>=0&&t[0]<=255&&t[1]>=0&&t[1]<=255&&t[2]>=0&&t[2]<=255&&t[3]>=0&&t[3]<=1}(e)||0===e[0]&&0===e[1]&&0===e[2])}},{key:"updateLightStatus",value:function(t,e,n){var o=this._lightStatus,i=o.on,r=o.color,a=o.luminosity;void 0===t||t===i?void 0===e||e===r?void 0===n||n===a||(this._lightStatus=this.createLightStatus(i,r,n)):this._lightStatus=this.createLightStatus(i,e,void 0===n||n===a?a:n):this._lightStatus=this.createLightStatus(t,void 0===e||e===r?r:e,void 0===n||n===a?a:n)}},{key:"convertLightStatusToColor",value:function(){var t=this._lightStatus,e=t.on,n=t.color,o=t.luminosity;return e&&0!==o?"rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", ").concat((o*n[3]).toFixed(2),")"):"transparent"}},{key:"light",get:function(){return this._light}},{key:"lightContext",get:function(){return this._lightContext}},{key:"lightColorChange$",get:function(){return this._lightColorChange$}}]),l}(b.Controller),p=l("fXoL"),C=l("/Uk7"),v=l("ofXK"),y=l("tXAj"),x=l("Wp6s"),k=l("f0Cb"),w=l("NFeN"),I=l("Qu3c"),P=l("1jcm"),L=l("3Pt+"),j=l("0hV+"),_=l("5RNC"),O=l("bTqV"),S=((g=function(){function e(){t(this,e)}return n(e,[{key:"transform",value:function(t,e){if(null!=t)return new Date}}]),e}()).\u0275fac=function(t){return new(t||g)},g.\u0275pipe=p.Kb({name:"dateNow",type:g,pure:!0}),g);function Q(t,e){if(1&t&&(p.Qb(0,"mat-icon",10),p.wc(1),p.Pb()),2&t){var n=e.ngIf;p.hc("matTooltip",n.isOnline?"Connected to "+n.brokerHost:"Not connected to "+n.brokerHost),p.zb(1),p.yc(" ",n.isOnline?"wifi":"wifi_off"," ")}}function T(t,e){if(1&t&&p.Mb(0,"img",11),2&t){var n=e.ngIf,o=p.bc();p.rc("background-color",o.light.isDefect?"transparent":n)}}function R(t,e){1&t&&(p.Qb(0,"mat-card-content"),p.wc(1,"Initializing..."),p.Pb())}function M(t,e){if(1&t){var n=p.Rb();p.Qb(0,"mat-card-content",12),p.Qb(1,"div",13),p.Qb(2,"mat-slide-toggle",14),p.Xb("ngModelChange",(function(t){return p.mc(n),p.bc().light.isDefect=t})),p.wc(3," Defect "),p.Pb(),p.Pb(),p.Qb(4,"qrcode",15,16),p.Xb("dragstart",(function(t){p.mc(n);var e=p.kc(5);return p.bc().onQrCodeDrag(t,e)}))("click",(function(t){return p.mc(n),p.bc().onQrCodeClick(t)})),p.Pb(),p.Qb(6,"h4",17),p.wc(7,"CONTEXT"),p.Pb(),p.Qb(8,"div",18),p.Qb(9,"div",19),p.wc(10,"Building"),p.Pb(),p.Qb(11,"mat-slider",20),p.Xb("ngModelChange",(function(t){return p.mc(n),p.bc().lightContext.building=t})),p.Pb(),p.Pb(),p.Qb(12,"div",18),p.Qb(13,"div",19),p.wc(14,"Floor"),p.Pb(),p.Qb(15,"mat-slider",20),p.Xb("ngModelChange",(function(t){return p.mc(n),p.bc().lightContext.floor=t})),p.Pb(),p.Pb(),p.Qb(16,"div",18),p.Qb(17,"div",19),p.wc(18,"Room"),p.Pb(),p.Qb(19,"mat-slider",20),p.Xb("ngModelChange",(function(t){return p.mc(n),p.bc().lightContext.room=t})),p.Pb(),p.Pb(),p.Pb()}if(2&t){var o=p.bc();p.zb(2),p.hc("color","warn")("ngModel",o.light.isDefect),p.zb(2),p.hc("title","")("qrdata",o.qrCodeUrl)("elementType","svg")("errorCorrectionLevel","M")("width","100%")("margin",0)("cssClass","light-map-card-image-qrcode-div"),p.zb(7),p.hc("min",o.lightContextRanges.building.min)("max",o.lightContextRanges.building.max)("tickInterval",o.lightContextRanges.building.tickInterval)("step",1)("thumbLabel",!0)("ngModel",o.lightContext.building),p.zb(4),p.hc("min",o.lightContextRanges.floor.min)("max",o.lightContextRanges.floor.max)("tickInterval",o.lightContextRanges.floor.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",o.lightContext.floor),p.zb(4),p.hc("min",o.lightContextRanges.room.min)("max",o.lightContextRanges.room.max)("tickInterval",o.lightContextRanges.room.tickInterval)("step",1)("thumbLabel",!0)("tickInterval",10)("ngModel",o.lightContext.room)}}function E(t,e){if(1&t&&(p.Qb(0,"mat-card-footer",3),p.Qb(1,"div"),p.wc(2),p.cc(3,"date"),p.cc(4,"dateNow"),p.cc(5,"async"),p.Pb(),p.Qb(6,"div",21),p.Qb(7,"a",22),p.Mb(8,"img",23),p.Pb(),p.Qb(9,"a",24),p.Mb(10,"img",25),p.Pb(),p.Pb(),p.Pb()),2&t){var n=e.ngIf,o=p.bc();p.zb(2),p.yc("Last switched: ",p.ec(3,2,p.dc(4,5,p.dc(5,7,o.lastSwitched$)),"HH:mm:ss.SSS"),""),p.zb(5),p.hc("matTooltip",(null==n?null:n.packageInfo.name)+"@"+(null==n?null:n.packageInfo.version)+" on GitHub")}}var z,D,q,N=[{path:"",component:(z=function(){function e(n,o,i){t(this,e),this.appContext=n,this.location=o,this.appContext.setContext("Light"),this.initNgModelBindings(),this.connectLightController(i)}return n(e,[{key:"ngOnDestroy",value:function(){this.lightContainer&&this.lightContainer.shutdown()}},{key:"onQrCodeClick",value:function(t){window.open(this.qrCodeUrl,"_blank")}},{key:"onQrCodeDrag",value:function(t,e){e.hide(),t.dataTransfer.setData("text/plain",this.qrCodeUrl),t.dataTransfer.setData("text/qrcode",this.qrCodeUrl)}},{key:"getQrCodeUrl",value:function(){var t=this.location.prepareExternalUrl("/control?light_id="+(this.light?this.light.objectId:""));return window.location.protocol+"//"+window.location.host+t}},{key:"initNgModelBindings",value:function(){this.lightContext={building:0,floor:0,room:0},this.lightContextRanges={building:{min:0,max:0,tickInterval:1},floor:{min:0,max:0,tickInterval:1},room:{min:0,max:0,tickInterval:1}}}},{key:"connectLightController",value:function(t){var e=this;t.resolveContainer("LightAgent","LightController",f).then((function(t){e.lightContainer=t;var n=t.getController("LightController");e.lightContextRanges=t.runtime.commonOptions.extra.lightContextRanges,e.light=n.light,e.lightContext=n.lightContext,e.lightColor$=n.lightColorChange$,e.lastSwitched$=n.lightColorChange$.pipe(Object(u.a)(1)),e.qrCodeUrl=e.getQrCodeUrl(),e.initBrokerConnectionInfo(n.options),e.appContext.setContext("Light #"+e.light.objectId)})).catch((function(t){throw new Error("Agent container for LightComponent couldn't be resolved: "+t)}))}},{key:"initBrokerConnectionInfo",value:function(t){var e=this;this.brokerConnectionInfo$=this.lightContainer.communicationManager.observeCommunicationState().pipe(Object(d.a)((function(t){return{state:t,isOnline:t===b.CommunicationState.Online,brokerHost:e.lightContainer.communicationManager.options.brokerUrl}})))}}]),e}(),z.\u0275fac=function(t){return new(t||z)(p.Lb(C.a),p.Lb(v.i),p.Lb(y.a))},z.\u0275cmp=p.Fb({type:z,selectors:[["app-light"]],decls:17,vars:15,consts:[[1,"app-card","light-card-dark"],["mat-card-avatar","",1,"light-card-header-avatar"],[1,"app-text-with-ellipsis"],[1,"light-card-subtitle-dark"],["class","light-card-title-icon",3,"matTooltip",4,"ngIf"],["mat-card-image","","class","app-map-card-image-centered light-card-image-mask","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",3,"background-color",4,"ngIf","ngIfElse"],["initializing",""],["class","light-card-content",4,"ngIf"],[1,"light-card-divider-dark"],["class","light-card-subtitle-dark",4,"ngIf"],[1,"light-card-title-icon",3,"matTooltip"],["mat-card-image","","src","./assets/images/light-bulb-mask.png","alt","Photo of a light bulb",1,"app-map-card-image-centered","light-card-image-mask"],[1,"light-card-content"],[1,"light-operation-param"],["aria-label","light defect switch",3,"color","ngModel","ngModelChange"],["draggable","true","matTooltip","Click or scan or drag QR Code onto context filter to switch this light","matTooltipPosition","above",1,"light-map-card-image-qrcode",3,"title","qrdata","elementType","errorCorrectionLevel","width","margin","cssClass","dragstart","click"],["qrCodeTooltip","matTooltip"],[1,"app-heading-no-top-margin"],[1,"light-card-context"],[1,"light-card-slider-label"],[3,"min","max","tickInterval","step","thumbLabel","ngModel","ngModelChange"],[1,"app-card-footer-link-group"],["mat-button","","href","https://github.com/coatyio/coaty-examples/tree/master/remote-operations/js","target","_blank",3,"matTooltip"],["src","./assets/images/github-icon.svg","alt","github-logo"],["mat-button","","href","https://coaty.io","target","_blank"],["src","./assets/images/coaty-logo-accent.svg","alt","coaty-logo"]],template:function(t,e){if(1&t&&(p.Qb(0,"mat-card",0),p.Qb(1,"mat-card-header"),p.Mb(2,"a",1),p.Qb(3,"mat-card-title",2),p.wc(4),p.cc(5,"async"),p.Pb(),p.Qb(6,"mat-card-subtitle",3),p.wc(7),p.Pb(),p.uc(8,Q,2,2,"mat-icon",4),p.cc(9,"async"),p.Pb(),p.uc(10,T,1,2,"img",5),p.cc(11,"async"),p.uc(12,R,2,0,"ng-template",null,6,p.vc),p.uc(14,M,20,29,"mat-card-content",7),p.Mb(15,"mat-divider",8),p.uc(16,E,11,9,"mat-card-footer",9),p.Pb()),2&t){var n=p.kc(13);p.zb(4),p.yc("",p.dc(5,9,e.appContext.context$)," "),p.zb(3),p.Ac("Building ",null==e.lightContext?null:e.lightContext.building," \u22c5 Floor ",null==e.lightContext?null:e.lightContext.floor," \u22c5 Room ",null==e.lightContext?null:e.lightContext.room," "),p.zb(1),p.hc("ngIf",p.dc(9,11,e.brokerConnectionInfo$)),p.zb(2),p.hc("ngIf",p.dc(11,13,e.lightColor$))("ngIfElse",n),p.zb(4),p.hc("ngIf",e.lightContainer),p.zb(2),p.hc("ngIf",null==e.lightContainer?null:e.lightContainer.runtime.commonOptions.agentInfo)}},directives:[x.a,x.f,x.c,x.j,x.i,v.m,k.a,w.a,I.a,x.g,x.d,P.a,L.g,L.i,j.a,_.a,x.e,O.a],pipes:[v.b,v.e,S],styles:[".light-card-dark{background:#37474f;color:#eceff1}.light-card-divider-dark{background:#607d8b}.light-card-subtitle-dark{color:#b0bec5}.light-card-header-avatar{background-image:url(light-bulb-avatar.jpg);background-size:cover}.light-card-title-icon{margin-left:auto;margin-right:32px}.light-operation-param{color:#424242;display:flex;align-items:center;flex:0 0 auto;position:absolute!important;margin-top:calc(-65% + 8px)!important;left:12px;right:8px}.light-card-image-mask{background-image:url(light-bulb.jpg);background-size:cover;background-color:transparent;background-blend-mode:overlay;transition:background-color 1s linear}.light-map-card-image-qrcode{position:absolute!important;margin-top:calc(-30vw - 34px)!important;width:30vw;height:30vw;left:8px;right:8px;border:4px solid transparent;border-radius:4px;cursor:-webkit-grab;cursor:grab}.light-map-card-image-qrcode:hover{border-color:#ffd740}.light-map-card-image-qrcode-div{width:100%;height:100%}.light-card-content{margin-bottom:8px}.light-card-context{display:flex;align-items:center}.light-card-slider-label{align-self:baseline;min-width:4em}"],encapsulation:2,changeDetection:0}),z)}],U=((q=function e(){t(this,e)}).\u0275mod=p.Jb({type:q}),q.\u0275inj=p.Ib({factory:function(t){return new(t||q)},imports:[[h.c.forChild(N)],h.c]}),q),$=((D=function e(){t(this,e)}).\u0275mod=p.Jb({type:D}),D.\u0275inj=p.Ib({factory:function(t){return new(t||D)},imports:[[s.a,U]]}),D)}}])}();